<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown PDF ì—ë””í„° Pro V5.71</title>
    
    <!-- CSS Dependencies -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    
    <!-- JS Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', 'Noto Sans KR', sans-serif; overflow-x: hidden; }

        /* ì •ë ¬ ìŠ¤íƒ€ì¼ */
        .align-left { text-align: left !important; display: block; width: 100%; }
        .align-center { text-align: center !important; display: block; width: 100%; margin-left: auto; margin-right: auto; }
        .align-right { text-align: right !important; display: block; width: 100%; }
        
        .align-center img, .align-center p img { margin-left: auto; margin-right: auto; display: block; }
        .align-right img, .align-right p img { margin-left: auto; margin-right: 0; display: block; }

        /* í˜ì´ì§€ ë‚˜ëˆ„ê¸° ê°€ì´ë“œ */
        .page-break { page-break-after: always; height: 0; margin: 0; border: none; }
        .page-break-divider {
            height: 40px;
            background-color: #cbd5e1;
            margin: 0 -60px; 
            position: relative;
            border-top: 2px solid #94a3b8;
            border-bottom: 2px solid #94a3b8;
            display: flex;
            align-items: center;
            justify-content: center;
            clear: both;
            pointer-events: none;
        }
        .page-break-divider::after {
            content: attr(data-page);
            background: #3b82f6;
            color: white;
            padding: 4px 18px;
            font-size: 12px;
            font-weight: bold;
            border-radius: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.15);
        }

        /* ë©”ì¸ ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ */
        #right-pane { background-color: #94a3b8 !important; overflow: auto; display: block; }
        #html-output-container { width: 100%; padding: 60px 0; display: flex; justify-content: center; overflow-y: auto; }

        /* ë ˆì´ì•„ì›ƒ ê·œê²© ê³ ì •: 1000px ê³ ì • ë° ì—¬ë°± 40px 60px */
        #html-output,
        #full-preview-pane .prose {
            background-color: white !important; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.35); 
            min-height: 297mm; 
            width: 1000px; 
            max-width: none; 
            padding: 40px 60px !important;
            box-sizing: border-box;
            color: black;
            word-break: keep-all;
            overflow-wrap: break-word;
            margin: 0 auto; 
            flex-shrink: 0;
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .prose table { width: 100%; border-collapse: collapse; margin: 1em 0; border: 1px solid #e5e7eb; }
        .prose table th, .prose table td { border: 1px solid #e5e7eb; padding: 12px; color: inherit; font-size: 1em; }
        .prose th { background-color: rgba(0,0,0,0.05); font-weight: bold; }

        /* ëª¨ë‹¬ ë° UI */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.85); z-index: 3000; padding: 20px;
            backdrop-filter: blur(4px);
        }
        .modal-content {
            background: #1e293b; color: white; border-radius: 12px;
            max-width: 800px; margin: 40px auto; padding: 24px; border: 1px solid #334155;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
        }

        #full-edit-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1500; padding: 0; background: #0f172a; }
        #full-edit-container { width: 100%; height: 100%; display: flex; flex-direction: column; background: #1e293b; overflow: hidden; }
        #full-edit-body { flex: 1; display: flex; overflow: hidden; }
        #full-edit-area { flex: 1; width: 50%; padding: 30px; background: #0f172a; color: #f1f5f9; font-family: 'JetBrains Mono', monospace; font-size: 15px; line-height: 1.7; outline: none; resize: none; border: none; }
        
        #full-preview-pane { flex: 1; width: 50%; background: #94a3b8; overflow: auto; display: none; }
        #full-preview-pane .prose-wrapper { width: 100%; padding: 40px; display: flex; flex-direction: column; align-items: center; }

        .toolbar { background: #1e293b; padding: 10px 16px; border-bottom: 1px solid #334155; display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
        .btn-tool { background: #334155; color: #cbd5e1; padding: 6px 10px; border-radius: 4px; font-size: 12px; font-weight: bold; cursor: pointer; border: 1px solid transparent; transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        .btn-tool:hover { background: #475569; color: white; border-color: #3b82f6; }
        .btn-action { padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 700; transition: 0.2s; }

        #message-box { display: none; position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #3b82f6; color: white; padding: 12px 24px; border-radius: 30px; z-index: 6000; font-weight: bold; box-shadow: 0 10px 20px rgba(0,0,0,0.3); }

        .color-preset { width: 24px; height: 24px; border-radius: 50%; cursor: pointer; border: 2px solid rgba(255,255,255,0.2); transition: transform 0.2s; }
        .font-size-btn { width: 42px; height: 34px; background: #3b82f6; color: white; border-radius: 6px; font-weight: bold; font-size: 18px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .font-size-val { min-width: 40px; text-align: center; font-family: 'JetBrains Mono'; font-weight: bold; color: #60a5fa; }

        /* ë ˆì´ì•„ì›ƒ ì „í™˜ CSS */
        .layout-full-editor #right-pane, .layout-full-editor #resizer { display: none !important; }
        .layout-full-editor #left-pane { width: 100% !important; }
        .layout-full-preview #left-pane, .layout-full-preview #resizer { display: none !important; }
        .layout-full-preview #right-pane { width: 100% !important; display: block !important; }

        .toc-list { background: #f8fafc; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; border: 1px solid #e2e8f0; border-left: 5px solid #3b82f6; color: #1e293b; }
        .hotkey-input { background: #0f172a; border: 1px solid #475569; color: #60a5fa; padding: 4px 8px; border-radius: 4px; font-family: monospace; width: 100%; outline: none; }
        
        /* ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¡´ ê°•ì¡° ìŠ¤íƒ€ì¼ */
        #image-drop-zone.dragover { border-color: #3b82f6; background-color: rgba(59, 130, 246, 0.15); }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 antialiased">

    <div id="message-box"></div>

    <!-- ëª¨ë‹¬: ë²„ì „ íˆìŠ¤í† ë¦¬ -->
    <div id="history-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-blue-400">ë²„ì „ íˆìŠ¤í† ë¦¬</h3>
                <button onclick="closeModal('history-modal')" class="text-gray-400 hover:text-white">âœ•</button>
            </div>
            <div id="version-list" class="max-h-[400px] overflow-y-auto space-y-2 pr-2"></div>
            <div class="mt-6 flex justify-end">
                <button onclick="closeModal('history-modal')" class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-md font-bold">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ëª¨ë‹¬: ë‹¨ì¶•í‚¤ ì„¤ì • -->
    <div id="hotkeys-modal" class="modal-overlay">
        <div class="modal-content !max-w-2xl">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-blue-400">ë‹¨ì¶•í‚¤ ì„¤ì •</h3>
                <button onclick="closeModal('hotkeys-modal')" class="text-gray-400 hover:text-white">âœ•</button>
            </div>
            <div class="max-h-[450px] overflow-y-auto pr-2">
                <table class="w-full text-left text-sm">
                    <thead><tr><th class="p-2 border-b border-gray-700">ê¸°ëŠ¥</th><th class="p-2 border-b border-gray-700">ë‹¨ì¶•í‚¤ ë§¤í•‘</th></tr></thead>
                    <tbody id="hotkey-settings-body"></tbody>
                </table>
            </div>
            <div class="mt-6 flex justify-end gap-2">
                <button onclick="saveHotkeys()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md font-bold transition">ì €ì¥ ë° ì ìš©</button>
                <button onclick="closeModal('hotkeys-modal')" class="bg-gray-700 hover:bg-gray-600 text-white px-6 py-2 rounded-md font-bold transition">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ëª¨ë‹¬: í•­ëª© ì‚½ì… -->
    <div id="insert-modal" class="modal-overlay">
        <div class="modal-content !max-w-md">
            <h4 id="insert-title" class="font-bold text-blue-400 mb-4 text-lg">í•­ëª© ì‚½ì…</h4>
            <div id="url-section" class="flex flex-col gap-4">
                <div>
                    <label class="text-xs text-gray-400 block mb-1">í‘œì‹œí•  í…ìŠ¤íŠ¸ (Alt)</label>
                    <input type="text" id="link-text-input" class="w-full bg-gray-900 border border-gray-700 rounded-md px-3 py-2 text-sm outline-none focus:border-blue-500">
                </div>
                <div>
                    <label class="text-xs text-gray-400 block mb-1">URL ì£¼ì†Œ / ì´ë¯¸ì§€ ì£¼ì†Œ</label>
                    <input type="text" id="link-url-input" class="w-full bg-gray-900 border border-gray-700 rounded-md px-3 py-2 text-sm outline-none focus:border-blue-500">
                </div>
                <div id="new-window-option" class="flex items-center gap-2 py-1">
                    <input type="checkbox" id="url-new-window" class="w-4 h-4 rounded border-gray-700 bg-gray-900 text-blue-600">
                    <label for="url-new-window" class="text-sm text-gray-300">ìƒˆ ì°½ì—ì„œ ì—´ê¸° (_blank)</label>
                </div>
            </div>
            <div id="upload-section" class="hidden">
                <div id="image-drop-zone" class="w-full py-10 border-2 border-dashed border-gray-600 rounded-lg flex flex-col items-center justify-center bg-gray-800 cursor-pointer transition-colors">
                    <svg class="w-8 h-8 text-gray-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    <p class="text-xs text-gray-400 text-center px-4">ì´ë¯¸ì§€ë¥¼ ë“œë¡­í•˜ê±°ë‚˜ ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”</p>
                    <input type="file" id="image-upload-input" class="hidden" accept="image/*">
                </div>
                <div id="upload-status" class="mt-2 text-xs text-blue-400 font-bold text-center hidden"></div>
            </div>
            <div id="img-options" class="hidden mt-4">
                <label class="text-xs text-gray-400 block mb-1 font-bold">ë„ˆë¹„ (ì˜ˆ: 100%, 300px)</label>
                <input type="text" id="img-width-input" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-xs outline-none" placeholder="100%">
            </div>
            <div class="flex gap-2 justify-end mt-6 pt-4 border-t border-gray-700">
                <button id="insert-confirm-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md font-bold">í™•ì¸</button>
                <button onclick="closeModal('insert-modal')" class="bg-gray-700 hover:bg-gray-600 text-white px-6 py-2 rounded-md font-bold transition">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ë ˆì´ì•„ì›ƒ -->
    <div class="container mx-auto p-4 lg:p-6">
        <header class="flex justify-between items-end mb-6">
            <div>
                <h1 class="text-4xl font-bold text-white mb-1 tracking-tight">Markdown PDF ì—ë””í„° Pro</h1>
                <p class="text-gray-400 text-sm">ì „ë¬¸ í†µí•© ì›Œí¬í”Œë¡œìš° ì‹œìŠ¤í…œ (V5.71)</p>
            </div>
            <div class="flex gap-2 mb-1">
                <button onclick="toggleLayout('write')" class="bg-gray-800 text-[10px] text-gray-400 px-3 py-1.5 rounded border border-gray-700 hover:text-white transition">WriteFull</button>
                <button onclick="toggleLayout('split')" class="bg-gray-800 text-[10px] text-gray-400 px-3 py-1.5 rounded border border-gray-700 hover:text-white transition">Split</button>
                <button onclick="toggleLayout('view')" class="bg-gray-800 text-[10px] text-gray-400 px-3 py-1.5 rounded border border-gray-700 hover:text-white transition">ViewFull</button>
            </div>
        </header>

        <div class="bg-gray-800 p-4 rounded-t-xl border-x border-t border-gray-700 flex flex-wrap items-center justify-between gap-4 shadow-xl">
            <div class="flex flex-wrap gap-2 items-center">
                <label for="file-upload-input" class="cursor-pointer bg-blue-600 hover:bg-blue-700 text-white btn-action transition shadow-md">íŒŒì¼ ì—…ë¡œë“œ</label>
                <input id="file-upload-input" type="file" class="hidden" accept=".md,.txt">
                <div class="h-8 w-[1px] bg-gray-600 mx-1"></div>
                <button id="pdf-save-btn" class="bg-red-600 hover:bg-red-700 text-white btn-action transition shadow-md">PDF ì €ì¥/ë¯¸ë¦¬ë³´ê¸° (ìƒˆì°½)</button>
                <button id="md-save-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white btn-action transition shadow-md">MD ì €ì¥</button>
                <button id="txt-save-btn" class="bg-emerald-600 hover:bg-emerald-700 text-white btn-action transition shadow-md">TXT ì €ì¥</button>
                <div class="h-8 w-[1px] bg-gray-600 mx-1"></div>
                <button onclick="insertTag('pagebreak', markdownInput)" class="bg-orange-600 hover:bg-orange-700 text-white btn-action transition shadow-md">PageBreak</button>
                <button id="generate-toc-btn-main" class="bg-purple-600 hover:bg-purple-700 text-white btn-action transition shadow-md">ëª©ì°¨ ìƒì„±</button>
                <button id="open-full-edit" class="bg-slate-600 hover:bg-slate-700 text-white btn-action transition shadow-md">ì „ì²´ í™”ë©´ í¸ì§‘</button>
            </div>
            <div class="flex items-center gap-4 bg-gray-900 px-4 py-2 rounded-full border border-gray-700 shadow-inner">
                <span class="text-[10px] font-bold text-gray-500 uppercase tracking-widest">Base Font Size</span>
                <input type="range" id="font-size-slider" min="10" max="40" value="15" class="w-24 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer">
                <span id="font-size-label" class="text-sm font-bold text-blue-400 w-10 text-center">15px</span>
                <div class="h-4 w-[1px] bg-gray-700 mx-1"></div>
                <button onclick="showHistory()" class="text-[11px] font-bold text-emerald-400 hover:text-emerald-300 transition">History</button>
                <button onclick="openHotkeyModal()" class="text-[11px] font-bold text-blue-400 hover:text-blue-300 transition">Hotkeys</button>
                <button id="theme-toggle-btn" class="text-[11px] font-bold text-gray-400 hover:text-white ml-2 transition">ğŸŒ“</button>
            </div>
        </div>

        <main id="editor-main" class="flex h-[68vh] border-x border-b border-gray-700 rounded-b-xl overflow-hidden shadow-2xl bg-gray-950">
            <div id="left-pane" class="flex flex-col h-full w-1/2 border-r border-gray-700 overflow-hidden">
                <textarea id="markdown-input" class="w-full h-full p-8 bg-transparent resize-none focus:outline-none text-gray-300 leading-relaxed font-mono text-sm" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            </div>
            <div id="resizer" class="w-1 bg-gray-700 cursor-col-resize hover:bg-blue-500 transition-colors flex-shrink-0"></div>
            <div id="right-pane" class="flex flex-col h-full flex-grow overflow-hidden">
                <div id="html-output-container" class="h-full">
                    <div id="html-output" class="prose prose-lg" style="font-size: 15px;"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- ì „ì²´ í™”ë©´ í¸ì§‘ ëª¨ë‹¬ -->
    <div id="full-edit-modal">
        <div id="full-edit-container">
            <div class="toolbar">
                <div class="flex items-center gap-1">
                    <button id="apply-full-edit" class="bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-1.5 rounded text-xs font-bold shadow-md transition">ì €ì¥í›„ë‹«ê¸°</button>
                    <button id="close-full-edit" class="bg-gray-600 hover:bg-gray-500 text-white px-3 py-1.5 rounded text-xs font-bold transition">ì·¨ì†Œ</button>
                    <button id="open-new-window-btn" class="bg-blue-600 hover:bg-blue-500 text-white px-3 py-1.5 rounded text-xs font-bold shadow-md transition">ë¯¸ë¦¬ë³´ê¸°(ìƒˆì°½)</button>
                </div>
                <div class="flex-grow"></div>
                <div class="flex flex-wrap gap-1 items-center">
                    <button onclick="insertTag('h1', fullEditArea)" class="btn-tool">H1</button>
                    <button onclick="insertTag('h2', fullEditArea)" class="btn-tool">H2</button>
                    <button onclick="insertTag('h3', fullEditArea)" class="btn-tool">H3</button>
                    <div class="h-5 w-[1px] bg-gray-600 mx-1"></div>
                    <button onclick="insertTag('align-left', fullEditArea)" class="btn-tool" title="ì™¼ìª½">â«·</button>
                    <button onclick="insertTag('align-center', fullEditArea)" class="btn-tool" title="ê°€ìš´ë°">ã€“</button>
                    <button onclick="insertTag('align-right', fullEditArea)" class="btn-tool" title="ì˜¤ë¥¸ìª½">â«¸</button>
                    <div class="h-5 w-[1px] bg-gray-600 mx-1"></div>
                    <button onclick="insertTag('bold', fullEditArea)" class="btn-tool font-bold">B</button>
                    <button onclick="insertTag('italic', fullEditArea)" class="btn-tool italic">I</button>
                    <button onclick="insertTag('quote', fullEditArea)" class="btn-tool">Quote</button>
                    <button onclick="insertTag('br', fullEditArea)" class="btn-tool">BR</button>
                    <div class="h-5 w-[1px] bg-gray-600 mx-1"></div>
                    <button onclick="insertTag('table', fullEditArea)" class="btn-tool bg-indigo-900">Table</button>
                    <button onclick="handleTableAction('addRow', fullEditArea)" class="btn-tool">Row+</button>
                    <button onclick="handleTableAction('addCol', fullEditArea)" class="btn-tool">Col+</button>
                    <div class="h-5 w-[1px] bg-gray-600 mx-1"></div>
                    <button onclick="showInsertModal(fullEditArea, 'url')" class="btn-tool">Link</button>
                    <button onclick="showInsertModal(fullEditArea, 'img_url')" class="btn-tool bg-indigo-800">IMG Link</button>
                    <button onclick="showInsertModal(fullEditArea, 'upload')" class="btn-tool bg-blue-900">IMG UP</button>
                    <button onclick="generateTOC(fullEditArea)" class="btn-tool bg-purple-700">TOC</button>
                    <button onclick="insertTag('pagebreak', fullEditArea)" class="btn-tool bg-orange-700 text-white">Page Break</button>
                </div>
            </div>
            <div class="toolbar !bg-slate-900 !border-t-0 justify-between">
                <div class="flex items-center gap-2">
                    <div onclick="insertTag('color', fullEditArea, '#ff4d4d')" class="color-preset bg-[#ff4d4d]" title="Red"></div>
                    <div onclick="insertTag('color', fullEditArea, '#1dd1a1')" class="color-preset bg-[#1dd1a1]" title="Green"></div>
                    <div onclick="insertTag('color', fullEditArea, '#54a0ff')" class="color-preset bg-[#54a0ff]" title="Blue"></div>
                    <div onclick="insertTag('color', fullEditArea, '#feca57')" class="color-preset bg-[#feca57]" title="Yellow"></div>
                    <div onclick="insertTag('color', fullEditArea, '#a29bfe')" class="color-preset bg-[#a29bfe]" title="Purple"></div>
                    <input type="color" id="custom-color-picker" class="w-7 h-7 bg-transparent cursor-pointer p-0 ml-1">
                    <button onclick="insertTag('color', fullEditArea, document.getElementById('custom-color-picker').value)" class="text-[10px] bg-blue-600 text-white px-2 py-1 rounded">Apply</button>
                </div>
                <div class="flex items-center gap-1">
                    <button onclick="adjustFontSize(-1)" class="font-size-btn">-</button>
                    <span id="font-size-display" class="font-size-val">15</span>
                    <button onclick="adjustFontSize(1)" class="font-size-btn">+</button>
                    <button onclick="insertTag('fontsize', fullEditArea)" class="btn-tool bg-blue-600 text-white ml-1">SET</button>
                    <div class="h-6 w-[1px] bg-gray-600 mx-1"></div>
                    <select id="lang-select" class="bg-gray-800 text-white text-[10px] px-2 h-8 rounded border border-gray-600">
                        <option value="python">Python</option>
                        <option value="javascript">JS</option>
                        <option value="html">HTML</option>
                    </select>
                    <button onclick="insertCodeWithLang(fullEditArea)" class="btn-tool">Code Block</button>
                </div>
            </div>
            <div id="full-edit-body">
                <textarea id="full-edit-area" spellcheck="false" class="scroll-smooth"></textarea>
                <div id="full-preview-pane"><div class="prose-wrapper"><div class="prose prose-lg text-black"></div></div></div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let markdownInput, fullEditArea, outputContainer, fullPreviewPane, fontSizeSlider;
        let imageDropZone, imageUploadInput, droppedFile = null;
        let livePreviewWindow = null;
        let currentTargetArea = null;
        let currentPromptMode = 'url';
        const undoStack = [];
        let currentSelectionFontSize = 15;

        // ë ˆì´ì•„ì›ƒ ì „í™˜ í•¨ìˆ˜
        function toggleLayout(mode) {
            const m = document.getElementById('editor-main');
            const lp = document.getElementById('left-pane');
            if (!m || !lp) return;
            m.classList.remove('layout-full-editor', 'layout-full-preview');
            if (mode === 'write') m.classList.add('layout-full-editor');
            else if (mode === 'view') m.classList.add('layout-full-preview');
            else lp.style.width = '50%';
            updatePreview();
        }

        const DEFAULT_CONTENT = `ê°•ë ¥í•œ ì‹¤ì‹œê°„ A4 ë¯¸ë¦¬ë³´ê¸°ì™€ ì •ë°€í•œ PDF ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ì„ ê°–ì¶˜ ì›¹ ê¸°ë°˜ ë§ˆí¬ë‹¤ìš´ ì—ë””í„°

**ì œì‘ì: ë°•ì¤‘í¬ (ì—°ì„¸ëŒ€í•™êµ ì‹¬ë¦¬í•™ê³¼ ê²¸ì„êµìˆ˜) **

ë³¸ í”„ë¡œì íŠ¸ëŠ” ë‹¨ìˆœí•œ ë§ˆí¬ë‹¤ìš´ ë·°ì–´ë¥¼ ë„˜ì–´, ì‹¤ì œ ì¸ì‡„ ë° PDF ì €ì¥ ì‹œì˜ ë ˆì´ì•„ì›ƒì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•˜ë©° ë¬¸ì„œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ëœ ì „ë¬¸ í¸ì§‘ ë„êµ¬ì…ë‹ˆë‹¤.

<div class="align-center">

### âœ¨ ì£¼ìš” ê¸°ëŠ¥ ìƒì„¸ ì„¤ëª… ë° ì˜ˆì œ (Features & Examples)

</div>

1. ğŸ–¼ï¸ ì™„ë²½í•œ ì´ë¯¸ì§€ ê´€ë¦¬ (CORS ë¬¸ì œ í•´ê²°)
ì›¹ìƒì˜ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¤ê±°ë‚˜ ë‚´ ì»´í“¨í„°ì˜ íŒŒì¼ì„ ì§ì ‘ ë¬¸ì„œì— í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **IMG URL (ì›¹ ì£¼ì†Œ ë°©ì‹)**: ì¸í„°ë„·ì— ê³µê°œëœ ì´ë¯¸ì§€ ê²½ë¡œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **IMG UPLOAD (ë¡œì»¬ ì—…ë¡œë“œ ë°©ì‹)** - ê¶Œì¥: ì´ë¯¸ì§€ê°€ í…ìŠ¤íŠ¸ ë°ì´í„°ë¡œ ë¬¸ì„œì— ì§ì ‘ í¬í•¨ë˜ì–´ PDF ì €ì¥ ì‹œ 100% ì¶œë ¥ë©ë‹ˆë‹¤.

<div class="align-center">

ğŸ“Š **ìŠ¤ë§ˆíŠ¸ í‘œ(Table) í¸ì§‘ê¸°**
ë§ˆí¬ë‹¤ìš´ í‘œ ì‘ì„±ì´ ì„œíˆ´ëŸ¬ë„ ë²„íŠ¼ê³¼ ë‹¨ì¶•í‚¤ë§Œìœ¼ë¡œ ì •êµí•œ í‘œë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

| í•­ëª© | ê°’ | ë¹„ê³  |
| :--- | :--- | :--- |
| ë°ì´í„°1 | 100 | ì™„ë£Œ |

</div>

- **Row+ (í–‰ ì¶”ê°€)**: í‘œ ì¹¸ì— ì»¤ì„œë¥¼ ë‘ê³  ë‹¨ì¶•í‚¤ Alt+9.
- **Col+ (ì—´ ì¶”ê°€)**: í´ë¦­ ì‹œ í‘œ ì „ì²´ì— ìƒˆë¡œìš´ ì—´(Alt+0) ì¼ê´„ ì¶”ê°€.
- **í–‰ ë³µì œ (Shift + Alt + â†“)**: í˜„ì¬ íƒ€ì´í•‘ ì¤‘ì¸ ì¤„ì„ ì•„ë˜ë¡œ ë³µì‚¬.

<div class="page-break"></div>

ğŸ“„ **ì‹¤ì‹œê°„ PDF/A4 ë¯¸ë¦¬ë³´ê¸° ë° í˜ì´ì§€ ì œì–´**
ì´ ì—ë””í„°ì˜ í•µì‹¬ì€ **"ë³´ì´ëŠ” ëŒ€ë¡œ ì¸ì‡„ëœë‹¤"**ëŠ” ì ì…ë‹ˆë‹¤.
- **í˜ì´ì§€ ë‚˜ëˆ„ê¸° (Page Break)**: \`<div class="page-break"></div>\` ë˜ëŠ” ë‹¨ì¶•í‚¤ Ctrl + Enter. ë¯¸ë¦¬ë³´ê¸° ì°½ì— ë¬¼ë¦¬ì ì¸ ì¢…ì´ ê°„ê²© ê°€ì´ë“œê°€ ë‚˜íƒ€ë‚˜ë©°, PDF ì €ì¥ ì‹œ í•´ë‹¹ ì§€ì ë¶€í„° ë‹¤ìŒ í˜ì´ì§€ì— ì¸ì‡„ë©ë‹ˆë‹¤.
- **í™•ì¥í˜• ë ˆì´ì•„ì›ƒ**: ì´ì œ ë¯¸ë¦¬ë³´ê¸°ëŠ” ìµœëŒ€ 1000px ë„ˆë¹„ë¡œ ê³ ì •ë˜ì–´ ì¾Œì í•œ ê°€ë…ì„±ì„ ì œê³µí•©ë‹ˆë‹¤. (ì¢Œìš° ì—¬ë°± ê° 60px ì ìš©)

âŒ¨ï¸ **ìƒì‚°ì„± ë‹¨ì¶•í‚¤ ì‹œìŠ¤í…œ**
- **Alt + L / C / R**: ì™¼ìª½ / ê°€ìš´ë° / ì˜¤ë¥¸ìª½ ì •ë ¬
- **Alt + 8 / 9 / 0**: í‘œ ìƒì„± / í–‰ ì¶”ê°€ / ì—´ ì¶”ê°€
- **Ctrl + B / I**: êµµê²Œ / ê¸°ìš¸ì„
- **Ctrl + .**: ì¸ìš©êµ¬ (>)
- **Ctrl + Enter**: í˜ì´ì§€ ë‚˜ëˆ„ê¸° ì§€ì  ì‚½ì…
- **Ctrl + Z**: ì‹¤í–‰ ì·¨ì†Œ (Undo)
- **Shift + Alt + â†“**: í˜„ì¬ í–‰ ì•„ë˜ë¡œ ë³µì œ
- **Ctrl + Shift + Enter**: <br> ê°•ì œ ì¤„ë°”ê¿ˆ ì‚½ì…

ğŸ§ª **í•™ìˆ  ë° ê¸°ìˆ  ë¬¸ì„œ ì§€ì› (LaTeX & Code)**
- ìˆ˜ì‹ (LaTeX): ì¸ë¼ì¸ $a^2 + b^2 = c^2$, ë¸”ë¡ ìˆ˜ì‹ ì§€ì›.

ğŸ’¾ **ë©€í‹° í¬ë§· ì €ì¥ ë° ê´€ë¦¬**
PDF, MD, TXT ì €ì¥ ê¸°ëŠ¥ì„ ëª¨ë‘ ì§€ì›í•©ë‹ˆë‹¤.`;

        let hotkeyConfig = {
            'h2': 'Ctrl+Alt+2',
            'h3': 'Ctrl+Alt+3',
            'align-left': 'Shift+Alt+L',
            'align-center': 'Shift+Alt+C',
            'align-right': 'Shift+Alt+R',
            'table': 'Alt+8',
            'addRow': 'Alt+9',
            'addCol': 'Alt+0',
            'math-block': 'Alt+M',
            'math-inline': 'Shift+Alt+M',
            'code': 'Alt+C',
            'pagebreak': 'Ctrl+Enter',
            'br': 'Ctrl+Shift+Enter',
            'move-down': 'Alt+ArrowDown',
            'move-up': 'Alt+ArrowUp',
            'bold': 'Ctrl+B',
            'italic': 'Ctrl+I',
            'quote': 'Ctrl+.',
            'undo': 'Ctrl+Z'
        };

        function insertTagCustom(area, prefix, suffix) {
            if (!area) return;
            const start = area.selectionStart;
            const end = area.selectionEnd;
            const sel = area.value.substring(start, end);
            const inserted = prefix + (sel || "") + suffix;
            area.value = area.value.substring(0, start) + inserted + area.value.substring(end);
            const newPos = start + inserted.length;
            area.setSelectionRange(newPos, newPos);
            pushHistory(area.value);
            updatePreview();
            area.focus();
        }

        function showMessage(msg) {
            const box = document.getElementById('message-box');
            if (box) { box.innerText = msg; box.style.display = 'block'; setTimeout(() => box.style.display = 'none', 2500); }
        }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function pushHistory(val) {
            if (undoStack.length > 0 && undoStack[undoStack.length - 1] === val) return;
            undoStack.push(val);
            if (undoStack.length > 150) undoStack.shift();
        }

function preProcess(text) {
    let pageNum = 1;

    // 1ï¸âƒ£ page-break ì²˜ë¦¬
    text = text.replace(/<div class="page-break"><\/div>/g, (m) => {
        return `<div class="page-break-divider" data-page="Page ${++pageNum}"></div><div class="page-break"></div>`;
    });

    // 2ï¸âƒ£ ê´„í˜¸ ë˜ëŠ” ëŒ€ê´„í˜¸ í¬í•¨ bold ì˜ˆì™¸ ì²˜ë¦¬
    text = text.replace(/\*\*([^*]*[\[\]\(\)][^*]*)\*\*/g, (match, p1) => {
        return `<b>${p1}</b>`;
    });

    return text;
}

        function renderMath(element) {
            if (!element || !window.renderMathInElement) return;
            window.renderMathInElement(element, { delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}], throwOnError: false });
        }

        function syncScroll(source, target) {
            if (!source || !target) return;
            const maxSource = source.scrollHeight - source.clientHeight;
            if (maxSource <= 0) return;
            const ratio = source.scrollTop / maxSource;
            const maxTarget = target.scrollHeight - target.clientHeight;
            target.scrollTop = ratio * maxTarget;
        }

        let renderTimeout;
        function updatePreview() {
            clearTimeout(renderTimeout);
            renderTimeout = setTimeout(() => {
                const isFull = document.getElementById('full-edit-modal').style.display === 'block';
                const source = isFull ? fullEditArea : markdownInput;
                const out = isFull ? fullPreviewPane.querySelector('.prose') : document.getElementById('html-output');
                if (out && source) {
                    out.innerHTML = marked.parse(preProcess(source.value));
                    renderMath(out);
                    syncScroll(source, isFull ? fullPreviewPane : outputContainer);
                }
                if (livePreviewWindow && !livePreviewWindow.closed) syncLiveWindow();
            }, 10);
        }

        function syncLiveWindow() {
            const container = livePreviewWindow ? livePreviewWindow.document.getElementById('live-container') : null;
            if (container) {
                const isFull = document.getElementById('full-edit-modal').style.display === 'block';
                const source = isFull ? fullEditArea : markdownInput;
                container.innerHTML = marked.parse(preProcess(source.value));
                if (livePreviewWindow.renderMathInElement) livePreviewWindow.renderMathInElement(container, { delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}] });
                const maxSource = source.scrollHeight - source.clientHeight;
                if (maxSource > 0) {
                    const ratio = source.scrollTop / maxSource;
                    const win = livePreviewWindow;
                    const maxTarget = win.document.documentElement.scrollHeight - win.innerHeight;
                    win.scrollTo(0, ratio * maxTarget);
                }
            }
        }

        /* ğŸ”¥ PDF ì €ì¥ ë¯¸ë¦¬ë³´ê¸°ì™€ ì‹œê°ì ìœ¼ë¡œ ë™ì¼í•˜ë©° ì—¬ë°± ë° ê¸€ê¼´ í¬ê¸°ê°€ ìµœì í™”ëœ ìƒˆì°½ ì‹œìŠ¤í…œ */
        function openPreviewWindow() {
            if (!livePreviewWindow || livePreviewWindow.closed) {
                livePreviewWindow = window.open('', 'MarkdownLivePreview', 'width=1200,height=1000');
                const fs = document.getElementById('html-output').style.fontSize || '15px';
                
                livePreviewWindow.document.write(`
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ì •ë°€ A4 ë¯¸ë¦¬ë³´ê¸°</title>
<script src="https://cdn.tailwindcss.com?plugins=typography"><\/script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"><\/script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"><\/script>
<style>
body { margin: 0; background: #475569; overflow: auto; }
#a4-wrapper { width: 100%; display: flex; justify-content: center; padding: 40px 0; }
.viewer-content {
    background: white; 
    width: 100%;    /* width: 210mm;min-height: 297mm; transform-origin: top center; ì—ì„œ ìˆ˜ì •*/
    max-width: 1000px;
    min-height: auto;
    padding: 10mm 15mm; /* ğŸ”¥ ë‚´ë¶€ ì—¬ë°± ëŒ€í­ ì¶•ì†Œ (ê¸°ì¡´ 25x30 -> 10x15) */
    box-shadow: 0 20px 60px rgba(0,0,0,0.3); 
    box-sizing: border-box;
    color: black; 
    word-break: keep-all; 
    transform-origin: top center; 
    transition: transform 0.2s ease;
}
.prose { font-size: ${fs} !important; max-width: none; line-height: 1.6; }
.page-break-divider {
    border-top: 2px solid #94a3b8; border-bottom: 2px solid #94a3b8;
    margin: 30px -15mm; height: 30px; background: #94a3b8;
    display: flex; align-items: center; justify-content: center;
}
.page-break-divider::after {
    content: attr(data-page); background: #3b82f6; color: white;
    padding: 4px 18px; border-radius: 20px; font-size: 11px; font-weight: bold;
}
.page-break { page-break-after: always; }
.align-center { text-align: center !important; }
.align-right { text-align: right !important; }
</style>
</head>
<body>
<div id="a4-wrapper"><div id="live-container" class="viewer-content prose"></div></div>
<script>
/* ğŸ”¥ ìë™ ë°˜ì‘í˜• ìŠ¤ì¼€ì¼ ì—”ì§„ (ê¸€ê¼´ í¬ê¸° ì‹œê°ì  ë³´ì • ìœ„í•´ ìƒí•œì„  ì¡°ì •) */
function autoScale() {
    const sheet = document.querySelector('.viewer-content');
    if (!sheet) return;
    const sheetWidth = sheet.offsetWidth;
    const availableWidth = window.innerWidth - 40;
    let scale = availableWidth / sheetWidth;
    
    // ğŸ”¥ ìƒí•œì„ 1.2ë¡œ ë‚®ì¶”ì–´ ê¸€ìê°€ ë¹„ì •ìƒì ìœ¼ë¡œ ì»¤ ë³´ì´ëŠ” í˜„ìƒ í•´ê²° (ê¸°ì¡´ 1.8 -> 1.2)
    if (scale > 1.2) scale = 1.0; 
    sheet.style.transform = "scale(" + scale + ")";
}
window.addEventListener('resize', autoScale);
window.onload = autoScale;
<\/script>
</body>
</html>
                `);
                livePreviewWindow.document.close();
            } else {
                livePreviewWindow.focus();
            }
            setTimeout(syncLiveWindow, 200);
        }

        function openPDFWindow() {
            const win = window.open('', 'PDFPreview', 'width=1200,height=1000');
            const content = marked.parse(preProcess(markdownInput.value));
            const fs = document.getElementById('html-output').style.fontSize || '15px';
            win.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>PDF ì €ì¥ ë¯¸ë¦¬ë³´ê¸°</title><script src="https://cdn.tailwindcss.com?plugins=typography"><\/script><script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"><\/script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"><\/script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"><\/script><style>body { background: #475569; padding: 40px 0; display: flex; flex-direction: column; align-items: center; margin: 0; } .controls { position: fixed; top: 20px; right: 20px; z-index: 1000; } button { background: #ef4444; color: white; padding: 12px 24px; border-radius: 6px; font-weight: bold; cursor: pointer; border:none; box-shadow: 0 4px 15px rgba(0,0,0,0.3); } #export-target { background: white; width: 1000px; max-width: 1000px; padding: 40px 60px; box-shadow: 0 0 40px rgba(0,0,0,0.5); box-sizing: border-box; color: black; word-break: keep-all; } .prose { font-size: ${fs} !important; max-width: none; } .page-break-divider { display: none !important; } .page-break { page-break-after: always; } .align-center { text-align: center !important; } .align-right { text-align: right !important; }</style></head><body><div class="controls"><button onclick="downloadPDF()">ìµœì¢… PDF ë‹¤ìš´ë¡œë“œ</button></div><div id="export-target" class="prose">${content}</div><script>renderMathInElement(document.getElementById('export-target'), { delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}] }); function downloadPDF() { html2pdf().from(document.getElementById('export-target')).set({ margin: 0, filename: 'document.pdf', html2canvas: { scale: 2 }, jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } }).save(); }<\/script></body></html>`);
            win.document.close();
        }

        function insertTag(type, area, val = '') {
            if (!area) return;
            const start = area.selectionStart, end = area.selectionEnd, sel = area.value.substring(start, end);
            let prefix = "", suffix = "";
            switch(type) {
                case 'bold': prefix = "**"; suffix = "**"; break;
                case 'italic': prefix = "*"; suffix = "*"; break;
                case 'quote': prefix = "\n> "; break;
                case 'br': suffix = "<br>"; break;
                case 'pagebreak': prefix = "\n\n<div class=\"page-break\"></div>\n\n"; break;
                case 'h1': prefix = "# "; break;
                case 'h2': prefix = "## "; break;
                case 'h3': prefix = "### "; break;
                case 'align-left': prefix = "\n<div class=\"align-left\">\n\n"; suffix = "\n\n</div>\n"; break;
                case 'align-center': prefix = "\n<div class=\"align-center\">\n\n"; suffix = "\n\n</div>\n"; break;
                case 'align-right': prefix = "\n<div class=\"align-right\">\n\n"; suffix = "\n\n</div>\n"; break;
                case 'table': prefix = "\n| Header | Header |\n| :--- | :--- |\n| Cell | Cell |\n"; break;
                case 'color': prefix = `<span style="color:${val}">`; suffix = "</span>"; break;
                case 'fontsize': prefix = `<span style="font-size:${currentSelectionFontSize}px">`; suffix = "</span>"; break;
            }
            const text = prefix + (sel || '') + suffix;
            area.value = area.value.substring(0, start) + text + area.value.substring(end);
            area.setSelectionRange(start + text.length, start + text.length);
            pushHistory(area.value);
            updatePreview();
            area.focus();
        }

        function insertCodeWithLang(area) {
            const langSelect = document.getElementById('lang-select');
            const lang = langSelect ? langSelect.value.trim() : '';
            const start = area.selectionStart, end = area.selectionEnd, selected = area.value.substring(start, end);
            let block = lang ? `\n\`\`\`${lang}\n${selected || '# code'}\n\`\`\`\n` : `\n\`\`\`\n${selected || '# code'}\n\`\`\`\n`;
            area.value = area.value.substring(0, start) + block + area.value.substring(end);
            pushHistory(area.value); updatePreview(); area.focus();
        }

        function handleTableAction(action, area) {
            if (!area) return;
            const start = area.selectionStart, lines = area.value.split('\n');
            let idx = area.value.substring(0, start).split('\n').length - 1;
            const line = lines[idx];
            if (!line || !line.includes('|')) return insertTag('table', area);
            if (action === 'addRow') {
                const colCount = (line.match(/\|/g) || []).length - 1;
                lines.splice(idx + 1, 0, '|' + '   |'.repeat(colCount));
            } else if (action === 'addCol') {
                let s = idx, e = idx;
                while(s > 0 && lines[s-1].includes('|')) s--;
                while(e < lines.length - 1 && lines[e+1].includes('|')) e++;
                for(let i=s; i<=e; i++) {
                    let row = lines[i].trim();
                    if (!row.startsWith('|')) row = '| ' + row;
                    if (!row.endsWith('|')) row = row + ' |';
                    if (row.match(/\|[:\s-]*---[:\s-]*\|/)) lines[i] = row.substring(0, row.lastIndexOf('|')).trim() + ' | :--- |';
                    else if (i === s) lines[i] = row.substring(0, row.lastIndexOf('|')).trim() + ' | NewHeader |';
                    else lines[i] = row.substring(0, row.lastIndexOf('|')).trim() + ' |   |';
                }
            }
            area.value = lines.join('\n');
            pushHistory(area.value); updatePreview();
        }

        function generateTOC(area) {
            const target = area || markdownInput;
            const lines = target.value.split('\n');
            let toc = '\n<div class="toc-list">\n\n#### ëª©ì°¨\n\n';
            let found = false;
            lines.forEach(l => {
                const m = l.match(/^(#{1,3})\s+(.+)$/);
                if (m) {
                    const level = m[1].length;
                    const title = m[2].trim().replace(/<[^>]*>?/gm, '');
                    toc += `${'  '.repeat(level-1)}- [${title}](#${title.toLowerCase().replace(/ /g,'-')})\n`;
                    found = true;
                }
            });
            toc += '\n</div>\n\n';
            if (!found) return showMessage("ì œëª©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            target.value = toc + target.value;
            pushHistory(target.value); updatePreview();
        }

        function adjustFontSize(delta) {
            currentSelectionFontSize = Math.max(8, Math.min(72, currentSelectionFontSize + delta));
            const display = document.getElementById('font-size-display');
            if(display) display.innerText = currentSelectionFontSize;
            const label = document.getElementById('font-size-label');
            if(label) label.innerText = currentSelectionFontSize + 'px';
        }

        function showInsertModal(area, mode) {
            currentTargetArea = area; currentPromptMode = mode;
            document.getElementById('insert-modal').style.display = 'block';
            const urlSec = document.getElementById('url-section'), upSec = document.getElementById('upload-section');
            const imgOpt = document.getElementById('img-options'), targetOpt = document.getElementById('new-window-option');
            const title = document.getElementById('insert-title');
            if (mode === 'url') { title.innerText = "ë§í¬(URL) ì‚½ì…"; urlSec.classList.remove('hidden'); targetOpt.classList.remove('hidden'); upSec.classList.add('hidden'); imgOpt.classList.add('hidden'); }
            else if (mode === 'img_url') { title.innerText = "ì´ë¯¸ì§€ ì£¼ì†Œ(URL) ì‚½ì…"; urlSec.classList.remove('hidden'); targetOpt.classList.add('hidden'); upSec.classList.add('hidden'); imgOpt.classList.remove('hidden'); }
            else { title.innerText = "ì´ë¯¸ì§€ ë¡œì»¬ ì—…ë¡œë“œ"; urlSec.classList.add('hidden'); upSec.classList.remove('hidden'); imgOpt.classList.remove('hidden'); }
        }

        function openHotkeyModal() {
            const body = document.getElementById('hotkey-settings-body'); body.innerHTML = '';
            Object.entries(hotkeyConfig).forEach(([key, val]) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td class="p-2 border-b border-gray-800 font-bold text-gray-400 uppercase">${key}</td><td class="p-2 border-b border-gray-800"><input type="text" class="hotkey-input" data-key="${key}" value="${val}"></td>`;
                body.appendChild(tr);
            });
            document.getElementById('hotkeys-modal').style.display = 'block';
        }

        function saveHotkeys() {
            const inputs = document.querySelectorAll('.hotkey-input');
            inputs.forEach(inp => hotkeyConfig[inp.dataset.key] = inp.value);
            localStorage.setItem('pro_editor_hotkeys_v556', JSON.stringify(hotkeyConfig));
            closeModal('hotkeys-modal'); showMessage("ë‹¨ì¶•í‚¤ê°€ ì¦‰ì‹œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.");
        }

        function showHistory() {
            const list = document.getElementById('version-list');
            list.innerHTML = '';
            const snaps = Object.keys(localStorage).filter(k => k.startsWith('pro_snapshot_')).sort().reverse();
            snaps.forEach(k => {
                const d = new Date(parseInt(k.split('_')[2])).toLocaleString();
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center bg-gray-800 p-2 rounded';
                div.innerHTML = `<span class="text-xs text-gray-400">${d}</span><button onclick="restoreSnapshot('${k}')" class="text-blue-400 font-bold text-xs hover:underline">ë³µì›</button>`;
                list.appendChild(div);
            });
            document.getElementById('history-modal').style.display = 'block';
        }

        function restoreSnapshot(key) {
            if (confirm("ì´ ë²„ì „ìœ¼ë¡œ ë³µêµ¬í• ê¹Œìš”?")) {
                markdownInput.value = localStorage.getItem(key);
                updatePreview(); closeModal('history-modal');
            }
        }

        window.onload = function() {
            markdownInput = document.getElementById('markdown-input');
            fullEditArea = document.getElementById('full-edit-area');
            outputContainer = document.getElementById('html-output-container');
            fullPreviewPane = document.getElementById('full-preview-pane');
            fontSizeSlider = document.getElementById('font-size-slider');
            imageDropZone = document.getElementById('image-drop-zone');
            imageUploadInput = document.getElementById('image-upload-input');
            
            markdownInput.value = localStorage.getItem('pro_content_v562') || DEFAULT_CONTENT;
            pushHistory(markdownInput.value); updatePreview();

            // ì •ë°€ ìŠ¤í¬ë¡¤ ë™ê¸°í™” ì´ë²¤íŠ¸
            markdownInput.addEventListener('scroll', () => {
                syncScroll(markdownInput, outputContainer);
                if (livePreviewWindow) syncLiveWindow();
            });
            fullEditArea.addEventListener('scroll', () => {
                syncScroll(fullEditArea, fullPreviewPane);
                if (livePreviewWindow) syncLiveWindow();
            });

            markdownInput.addEventListener('input', () => { updatePreview(); localStorage.setItem('pro_content_v562', markdownInput.value); });
            fullEditArea.addEventListener('input', updatePreview);

            document.getElementById('pdf-save-btn').onclick = openPDFWindow;
            document.getElementById('generate-toc-btn-main').onclick = () => generateTOC(markdownInput);
            document.getElementById('open-full-edit').onclick = () => { fullEditArea.value = markdownInput.value; document.getElementById('full-edit-modal').style.display = 'block'; updatePreview(); };
            document.getElementById('apply-full-edit').onclick = () => { markdownInput.value = fullEditArea.value; pushHistory(markdownInput.value); updatePreview(); closeModal('full-edit-modal'); };
            document.getElementById('close-full-edit').onclick = () => closeModal('full-edit-modal');
            document.getElementById('open-new-window-btn').onclick = openPreviewWindow;

            fontSizeSlider.oninput = (e) => { const val = e.target.value; currentSelectionFontSize = parseInt(val); document.getElementById('font-size-label').innerText = val + 'px'; document.getElementById('html-output').style.fontSize = val + 'px'; document.getElementById('font-size-display').innerText = val; };

            if (imageDropZone && imageUploadInput) {
                imageDropZone.onclick = () => imageUploadInput.click();
                imageDropZone.ondragover = (e) => { e.preventDefault(); imageDropZone.classList.add('dragover'); };
                imageDropZone.ondragleave = () => imageDropZone.classList.remove('dragover');
                imageDropZone.ondrop = (e) => {
                    e.preventDefault(); imageDropZone.classList.remove('dragover');
                    if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                        droppedFile = e.dataTransfer.files[0];
                        const status = document.getElementById('upload-status'); status.innerText = `ì„ íƒë¨: ${droppedFile.name}`; status.classList.remove('hidden');
                    }
                };
                imageUploadInput.onchange = (e) => {
                    if (e.target.files && e.target.files[0]) {
                        droppedFile = e.target.files[0];
                        const status = document.getElementById('upload-status'); status.innerText = `ì„ íƒë¨: ${droppedFile.name}`; status.classList.remove('hidden');
                    }
                };
            }

            document.getElementById('insert-confirm-btn').onclick = async () => {
                const start = currentTargetArea.selectionStart;
                let tag = "";
                if (currentPromptMode === 'url') tag = `[${document.getElementById('link-text-input').value || "alt"}](${document.getElementById('link-url-input').value || "#"}${document.getElementById('url-new-window').checked ? '?target=_blank' : ''})`;
                else if (currentPromptMode === 'img_url') tag = `\n<div class="align-center"><img src="${document.getElementById('link-url-input').value || "#"}" style="width:${document.getElementById('img-width-input').value || "100%"};"></div>\n`;
                else {
                    const f = droppedFile || (imageUploadInput ? imageUploadInput.files[0] : null);
                    if (f) {
                        const src = await new Promise(r => { const rd = new FileReader(); rd.onload = ev => r(ev.target.result); rd.readAsDataURL(f); });
                        tag = `\n<div class="align-center"><img src="${src}" style="width:${document.getElementById('img-width-input').value || "100%"};"></div>\n`;
                    }
                    droppedFile = null;
                }
                currentTargetArea.value = currentTargetArea.value.substring(0, start) + tag + currentTargetArea.value.substring(currentTargetArea.selectionEnd);
                pushHistory(currentTargetArea.value); updatePreview(); closeModal('insert-modal');
                document.getElementById('link-text-input').value = ""; document.getElementById('link-url-input').value = "";
                document.getElementById('upload-status').classList.add('hidden');
            };

            const resizer = document.getElementById('resizer');
            resizer.onmousedown = (e) => {
                const move = (ev) => { const w = ev.clientX - document.getElementById('left-pane').parentElement.offsetLeft; if (w > 200 && w < window.innerWidth - 200) document.getElementById('left-pane').style.width = w + 'px'; };
                const up = () => { document.removeEventListener('mousemove', move); document.removeEventListener('mouseup', up); };
                document.addEventListener('mousemove', move); document.addEventListener('mouseup', up);
            };
        };

        window.onkeydown = function(e) {
            const isFull = document.getElementById('full-edit-modal').style.display === 'block';
            const ar = isFull ? fullEditArea : markdownInput;
            const match = (combo) => {
                if (!combo) return false;
                const parts = combo.toLowerCase().split('+'), key = parts.pop();
                return e.ctrlKey === parts.includes('ctrl') && e.altKey === parts.includes('alt') && e.shiftKey === parts.includes('shift') && (e.key.toLowerCase() === key || e.code.toLowerCase() === key.toLowerCase() || e.code.toLowerCase() === 'digit'+key);
            };

            if (e.altKey && !e.ctrlKey) {
                if (e.key === '8') { e.preventDefault(); insertTag('table', ar); return; }
                if (e.key === '9') { e.preventDefault(); handleTableAction('addRow', ar); return; }
                if (e.key === '0') { e.preventDefault(); handleTableAction('addCol', ar); return; }
            }
            if (e.shiftKey && e.ctrlKey && e.key === 'Enter') { e.preventDefault(); insertTag('br', ar); return; }
            if (match(hotkeyConfig['move-down'])) {
                e.preventDefault();
                const lines = ar.value.split('\n'), pos = ar.selectionStart, idx = ar.value.substring(0, pos).split('\n').length - 1;
                if (idx < lines.length - 1) { [lines[idx], lines[idx+1]] = [lines[idx+1], lines[idx]]; ar.value = lines.join('\n'); pushHistory(ar.value); updatePreview(); }
                return;
            }
            if (match(hotkeyConfig['move-up'])) {
                e.preventDefault();
                const lines = ar.value.split('\n'), pos = ar.selectionStart, idx = ar.value.substring(0, pos).split('\n').length - 1;
                if (idx > 0) { [lines[idx], lines[idx-1]] = [lines[idx-1], lines[idx]]; ar.value = lines.join('\n'); pushHistory(ar.value); updatePreview(); }
                return;
            }
            if (match(hotkeyConfig['math-block'])) { e.preventDefault(); insertTagCustom(ar, "\n$$\n", "\n$$\n"); return; }
            if (match(hotkeyConfig['math-inline'])) { e.preventDefault(); insertTagCustom(ar, "$", "$"); return; }
            if (match(hotkeyConfig['code'])) { e.preventDefault(); insertCodeWithLang(ar); return; }
            if (match(hotkeyConfig['align-left'])) { e.preventDefault(); insertTag('align-left', ar); return; }
            if (match(hotkeyConfig['align-center'])) { e.preventDefault(); insertTag('align-center', ar); return; }
            if (match(hotkeyConfig['align-right'])) { e.preventDefault(); insertTag('align-right', ar); return; }
            if (match(hotkeyConfig['h2'])) { e.preventDefault(); insertTag('h2', ar); return; }
            if (match(hotkeyConfig['h3'])) { e.preventDefault(); insertTag('h3', ar); return; }
            if (match(hotkeyConfig['bold'])) { e.preventDefault(); insertTag('bold', ar); return; }
            if (match(hotkeyConfig['italic'])) { e.preventDefault(); insertTag('italic', ar); return; }
            if (match(hotkeyConfig['quote'])) { e.preventDefault(); insertTag('quote', ar); return; }
            if (match(hotkeyConfig['pagebreak'])) { e.preventDefault(); insertTag('pagebreak', ar); return; }
            if (match(hotkeyConfig['undo'])) { e.preventDefault(); if (undoStack.length > 1) { undoStack.pop(); ar.value = undoStack[undoStack.length - 1]; updatePreview(); } return; }
            if (e.shiftKey && e.altKey && e.key === 'ArrowDown') {
                e.preventDefault();
                const start = ar.selectionStart, lines = ar.value.split('\n'), idx = ar.value.substring(0, start).split('\n').length - 1;
                lines.splice(idx + 1, 0, lines[idx]); ar.value = lines.join('\n'); pushHistory(ar.value); updatePreview();
            }
        };
    </script>
</body>
</html>



